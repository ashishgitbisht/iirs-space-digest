name: ðŸš€ IIRS Daily Space Digest + Pages Link
on:
  schedule:
    - cron: '30 2 * * *'  # 8AM IST daily
  workflow_dispatch:     # Manual button

permissions:
  contents: write        # Required to deploy to Pages

jobs:
  digest:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        
    - name: Install feedparser
      run: pip install feedparser
      
    - name: Generate HTML Newsletter
      # Ensure your python script saves file as 'index.html' for this to work best!
      run: python iirs_space_digest_git.py
      
    - name: ðŸš€ Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./
        publish_branch: gh-pages  # Deploys 'index.html' to this branch
        keep_files: true
        
    - name: âœ… Send Link to Gmail
      uses: dawidd6/action-send-mail@v3
      with:
        server_address: smtp.gmail.com
        server_port: 465
        username: ${{ secrets.GMAIL_USER }}
        password: ${{ secrets.GMAIL_PASS }}
        subject: 'ðŸš€ IIRS Space Digest Link | ${{ github.run_id }}'
        # EMAIL BODY WITH LINK
        body: |
          Today's space digest is ready!
          
          ðŸ”— READ ONLINE (Share this link):
          https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/
          
          (This link works on mobile & desktop immediately)
          
          Generated: ${{ steps.date.outputs.date }}
        to: ${{ secrets.GMAIL_USER }},${{ secrets.GMAIL_USER2 }},${{ secrets.GMAIL_USER3 }}
        from: 'IIRS Library <${{ secrets.GMAIL_USER }}>'
        # Optional: Keep attachment if you still want the file too
        attachments: 'index.html'
